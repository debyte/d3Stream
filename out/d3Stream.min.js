(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){module.exports=Stream;var U=require("./utility.js");var StreamTransform=require("./StreamTransform.js");var Display=require("./display/Display.js");function Stream(data,d3lib){StreamTransform.call(this,data,d3lib);this.displays=[]}Stream.prototype=Object.create(StreamTransform.prototype);Stream.prototype.constructor=Stream;Stream.prototype.load=function(url,options){var opt=options||{};var self=this;(opt.loader||d3loader)(url,opt,this.d3).then(function(data){self.update(data,opt)});return this;function d3loader(url,options,d3){if(options.format=="csv"){return d3.csv(url,{credentials:"same-origin"})}else if(options.format=="tsv"){return d3.tsv(url,{credentials:"same-origin"})}else if(options.format=="xml"){return d3.xml(url,{credentials:"same-origin"})}return d3.json(url,{credentials:"same-origin"})}};Stream.prototype.branch=function(){var b=new Stream(this.unstream());this.displays.push(b);return b};Stream.prototype.display=function(element,options){var d=new Display(this.d3,element,options,this.unstream());this.displays.push(d);return d};Stream.prototype.update=function(data,options){var opt=options||{};if(data!==undefined){if(opt.append){this.data=this.data.concat(data)}else if(opt.prepend){this.data=data.concat(this.data)}else{this.data=data}}var transformedData=this.unstream();for(var i=0;i<this.displays.length;i++){this.displays[i].update(transformedData)}return this};Stream.prototype.contains=function(item){return this.data.includes(item)};Stream.prototype.containedIn=function(list){return list.includes(this.data)};Stream.prototype.remove=function(item){U.remove(this.data,item);this.update();return this};Stream.prototype.empty=function(item){this.data=[];this.update();return this};Stream.prototype.add=function(item){return this.update(item,{append:true})};Stream.prototype.timeInterval=function(name,sub){if(name=="hour"||sub&&name=="day"){return this.d3.timeHour}else if(name=="day"||sub&&name=="week"){return this.d3.timeDay}else if(name=="week"||sub&&name=="month"){return this.d3.timeWeek}else if(name=="month"||sub&&name=="year"){return this.d3.timeMonth}else if(name=="year"){return this.d3.timeYear}return this.d3.timeDay};Stream.prototype.timeFormat=function(name,sub){if(name=="hour"||sub&&name=="day"){return this.d3.timeFormat("%H")}else if(name=="day"||sub&&name=="week"){return this.d3.timeFormat("%a")}else if(name=="week"||sub&&name=="month"){var f=this.d3.timeFormat("%U");return function(t){var n=1+parseInt(f(t));return n>52?n-52:n}}else if(name=="month"||sub&&name=="year"){return this.d3.timeFormat("%m")}else if(name=="year"){return this.d3.timeFormat("%Y")}return this.d3.timeFormat("%d.%m.")};Stream.prototype.colorScale=function(){return this.d3.scaleOrdinal(this.d3.schemePaired)}},{"./StreamTransform.js":3,"./display/Display.js":6,"./utility.js":16}],2:[function(require,module,exports){module.exports=StreamBase;function StreamBase(data,d3lib){this.d3=d3lib||d3;this.data=data;this.transformations=[]}StreamBase.prototype.addTransformation=function(transformFunction){this.transformations.push(transformFunction);return this};StreamBase.prototype.reset=function(){this.transformations=[];return this};StreamBase.prototype.unstream=function(){if(this.data===undefined||!this.transformations)return this.data;return this.transformations.reduce(function(data,t){return t(data)},this.data)};StreamBase.prototype.update=function(){}},{}],3:[function(require,module,exports){module.exports=StreamTransform;var U=require("./utility.js");var C=require("./calculation.js");var StreamBase=require("./StreamBase.js");function StreamTransform(data,d3lib){StreamBase.call(this,data,d3lib)}StreamTransform.prototype=Object.create(StreamBase.prototype);StreamTransform.prototype.constructor=StreamTransform;StreamTransform.prototype.consoleLog=function(){return this.addTransformation(function(data){U.consoleLog(data);return data})};StreamTransform.prototype.map=function(callback){return this.addTransformation(function(data){return U.asList(data).map(callback)})};StreamTransform.prototype.mapAsStreams=function(callback){return this.addTransformation(function(data){return U.asList(data).map(function(d,i){return U.unstream(callback(new StreamTransform(d),i))})})};StreamTransform.prototype.mapSubArrays=function(key,callback){return this.addTransformation(function(data){return U.asList(data).map(function(d1,i1){return U.asList(d1[key]).map(function(d2,i2){return callback(d1,d2,i1,i2)})})})};StreamTransform.prototype.filter=function(callback){return this.addTransformation(function(data){return U.asList(data).filter(callback)})};StreamTransform.prototype.keys=function(){return this.addTransformation(function(data){return data.length>0?Object.keys(data[0]):[]})};StreamTransform.prototype.mapToObject=function(callback){return this.addTransformation(function(data){return U.mapToObject(data,callback)})};StreamTransform.prototype.navigate=function(dotPath){return this.addTransformation(function(data){return U.navigate(data,dotPath)})};StreamTransform.prototype.cross=function(other){return this.addTransformation(function(data){return U.cross(data,U.unstream(other))})};StreamTransform.prototype.repeat=function(other){return this.addTransformation(function(data){return U.repeat(data,U.unstream(other))})};StreamTransform.prototype.group=function(conditions){return this.addTransformation(function(data){return U.group(data,U.unstream(conditions))})};StreamTransform.prototype.unique=function(){return this.addTransformation(function(data){return U.unique(data)})};StreamTransform.prototype.cumulate=function(parameters){return this.addTransformation(function(data){return U.cumulate(data,U.unstream(parameters))})};StreamTransform.prototype.merge=function(){return this.addTransformation(function(data){return this.d3.merge(data)})};StreamTransform.prototype.frequencies=function(groupkey,countkey){return this.addTransformation(function(data){return C.frequencies(data,groupkey,countkey)})};StreamTransform.prototype.periodically=function(period,accessor,timekey){return this.addTransformation(function(data){return C.periodically(data,period,accessor,timekey||"t",this.d3)})}},{"./StreamBase.js":2,"./calculation.js":4,"./utility.js":16}],4:[function(require,module,exports){var U=require("./utility.js");module.exports={frequencies:function(data,groupkey,countkey){var gks=U.asList(groupkey);if(gks.length==0)return[];var fdata=U.asList(data).map(function(d){return{keys:gks.map(function(k){return d[k]}),count:countkey===undefined?1:d[countkey]||0}}).filter(function(d){return!d.keys.includes(undefined)});var kdata=gks.map(function(k){return[]});fdata.forEach(function(d){d.keys.forEach(function(k,i){if(!kdata[i].includes(k)){kdata[i].push(k)}})});var map={};function mapRecursion(map,kdata){kdata[0].forEach(function(k){if(kdata.length>1){map[k]={};mapRecursion(map[k],kdata.slice(1))}else{map[k]=0}})}mapRecursion(map,kdata);function countRecursion(map,vks,count){if(vks.length>1){countRecursion(map[vks[0]],vks.slice(1),count)}else{map[vks[0]]+=count}}fdata.forEach(function(d){countRecursion(map,d.keys,d.count)});function arrayRecursion(map){return Object.keys(map).map(function(k){if(typeof map[k]=="object"){return{value:k,map:arrayRecursion(map[k])}}return{value:k,count:map[k]}})}return arrayRecursion(map)},periodically:function(data,interval,accessor,timekey){return U.asList(data).reduce(function(out,d){var val=accessor(d);(Array.isArray(val)?interval.range(interval.floor(val[0]),val[1]):[interval.floor(val)]).forEach(function(t){out.push(Object.assign({},d,U.obj([timekey,t.getTime()])))});return out},[])}}},{"./utility.js":16}],5:[function(require,module,exports){module.exports={height:200,marginTop:10,marginLeft:40,marginRight:30,marginBottom:30,horizontalAxis:true,verticalAxis:true,horizontalGrid:false,verticalGrid:false,groupLabels:false,combine:true,curveLine:false,stepLine:false,reverseStack:false,chartText:false,barMargin:.2,bandPadding:.2,textPadding:10,dotRadiusRange:[3,10],transitionDuration:500,chartTextFormat:".2f",labelClasses:"badge badge-light ml-1",horizontalVariable:"x",verticalVariable:"y",scaleVariable:"z",labelVariable:"label",groupVariable:"group",colorVariable:"color"}},{}],6:[function(require,module,exports){module.exports=Display;var DisplayFrame=require("./DisplayFrame.js");var resize=require("./resize.js");var lines=require("./lines.js");var bars=require("./bars.js");var tables=require("./tables.js");function Display(d3,element,options,data,parent,b){DisplayFrame.call(this,d3,element,options,data,parent,b);var self=this;resize(d3,function(){self.update()})}Display.prototype=Object.create(DisplayFrame.prototype);Display.prototype.constructor=Display;Display.prototype.branch=function(){return this.addBranch(Display)};Display.prototype.scatterPlot=function(options){return this.addChart(lines.scatterPlot,options)};Display.prototype.lineChart=function(options){return this.addChart(lines.lineChart,options)};Display.prototype.areaChart=function(options){return this.addChart(lines.areaChart,options)};Display.prototype.stackedAreaChart=function(options){return this.addChart(lines.stackedAreaChart,options)};Display.prototype.barChart=function(options){return this.addChart(bars.barChart,options)};Display.prototype.stackedBarChart=function(options){return this.addChart(bars.stackedBarChart,options)};Display.prototype.groupedBarChart=function(options){return this.addChart(bars.groupedBarChart,options)};Display.prototype.table=function(options){return this.addFrame(tables.table,options)};Display.prototype.table2d=function(options){return this.addFrame(tables.table2d,options)}},{"./DisplayFrame.js":8,"./bars.js":10,"./lines.js":11,"./resize.js":12,"./tables.js":13}],7:[function(require,module,exports){module.exports=DisplayBase;var C_DISPLAY="d3stream-display";var C_SVG="d3stream-svg";var C_PLOT="d3stream-plot";var U=require("../utility.js");var DU=require("./utility.js");var config=require("../config.js");var StreamTransform=require("../StreamTransform.js");var Select=require("./Select.js");function DisplayBase(d3,element,options,data,parent,b){StreamTransform.call(this,data);this.d3=d3;this.config=Object.assign({},config,options);this.b=b||0;this.display=parent?parent.display:createDisplay(d3,element,this.config);this.size=parent?parent.size:{width:0,height:0,inWidth:0,inHeight:0};this.select=parent?parent.select:new Select(d3,this.config);this.charts=[];this.frames=[];this.branches=[]}DisplayBase.prototype=Object.create(StreamTransform.prototype);DisplayBase.prototype.constructor=DisplayBase;DisplayBase.prototype.update=function(data,baxis){if(data!==undefined){this.data=data}this.size=getSize(this.display,this.config);this.select.clear();var transformedData=this.unstream()||[];var packedData=transformedData.length==0||!Array.isArray(transformedData[0])?[transformedData]:transformedData;var axis=baxis||DU.axis(this,packedData,this.config);this.branches.forEach(function(branch,i){branch.update(transformedData,axis)});var self=this;this.charts.forEach(function(chart,i){var plots=packedData.map(function(d,r){return getPlot(self.display,self.select,self.size,self.config,i,r,self.b)});chart[0](self,plots,axis,packedData,chart[1]);var r=packedData.length;while(removePlot(self.display,self.config,i,r,self.b))r+=1});this.frames.forEach(function(frame,i){frame[0](self,axis,packedData,frame[1])});if(this.config.update){this.config.update(this,transformedData)}};DisplayBase.prototype.addChart=function(chartFunction,options){this.charts.push([chartFunction,Object.assign({},this.config,options)]);return this};DisplayBase.prototype.addFrame=function(frameFunction,options){this.frames.push([frameFunction,Object.assign({},this.config,options)]);return this};DisplayBase.prototype.addBranch=function(cls){var d=new cls(this.d3,null,this.config,this.data,this,this.branches.length+1);this.branches.push(d);return d};DisplayBase.prototype.axis=function(data,variable){var domain=this.domain(data,variable);var axis={variable:variable,baseVariable:"_b"+variable,missing:domain.missing,config:domain.config,domain:domain.domain,scale:domain.scale?domain.scale:this.d3.scaleLinear().domain(domain.domain).nice(),pick:function(d,w){return picker(this.scale,d,this.variable,w)},pickBase:function(d,w){return picker(this.scale,d,this.baseVariable,w,0)},pickDistance:function(d){return Math.abs(this.pickBase(d)-this.pick(d))},pickValue:function(d){return Math.abs(d[this.variable]-(d[this.baseVariable]||0))},pickZero:function(){return this.scale(0)},pickMin:function(){return this.scale(this.domain[0])}};return axis;function picker(scale,d,k,w,a){var v=d[k]!==undefined?d[k]:a;if(v===undefined)return v;return scale(v)+(scale.bandwidth?w!==undefined?0:scale.bandwidth()/2:w!==undefined?-w:0)}};DisplayBase.prototype.domain=function(data,variable){return{domain:[0,1]}};function createDisplay(d3,element,options){if(typeof jQuery=="function"&&element instanceof jQuery){element=element[0]}element=d3.select(element);var display=element.append("div");display.classed(DU.a(C_DISPLAY,options.class),true);return display}function getSize(element,options){var width=options.width||element.node().offsetWidth;var height=options.height||element.node().offsetHeight;return{width:width,height:height,inWidth:width-options.marginLeft-options.marginRight,inHeight:height-options.marginTop-options.marginBottom}}function getPlot(display,select,size,options,i,r,b){var clsSvg=[C_SVG,options.combine?1:r].join("-");var svg=display.select(DU.s(clsSvg));if(svg.empty()){svg=display.append("svg").attr("class",DU.a(C_SVG,clsSvg));select.register(svg)}svg.attr("width",size.width).attr("height",size.height);var clsPlot=[C_PLOT,b,r,i].join("-");var plot=svg.select(DU.s(clsPlot));if(plot.empty()){plot=svg.append("g").attr("class",DU.a(C_PLOT,clsPlot)).attr("transform",DU.translateMargins(options))}return plot}function removePlot(display,options,i,r,b){var clsSvg=[C_SVG,options.combine?1:r].join("-");var svg=display.select(DU.s(clsSvg));if(svg.empty())return false;if(!options.combine){svg.remove();return true}var clsPlot=[C_PLOT,b,r,i].join("-");var plot=svg.select(DU.s(clsPlot));if(plot.empty())return false;plot.remove();return true}},{"../StreamTransform.js":3,"../config.js":5,"../utility.js":16,"./Select.js":9,"./utility.js":14}],8:[function(require,module,exports){module.exports=DisplayFrame;var C_AXIS_X="d3stream-axis-x";var C_AXIS_Y="d3stream-axis-y";var C_GRID_X="d3stream-grid-x";var C_GRID_Y="d3stream-grid-y";var C_LABELS="d3stream-labels";var U=require("../utility.js");var DU=require("./utility.js");var DisplayBase=require("./DisplayBase.js");function DisplayFrame(d3,element,options,data,parent,b){DisplayBase.call(this,d3,element,options,data,parent,b);this.domainFunction=parent?parent.domainFunction:{};if(parent===undefined){if(this.config.horizontalAxis){this.addFrame(makeAxisHorizontal)}if(this.config.verticalAxis){this.addFrame(makeAxisVertical)}if(this.config.groupLabels){this.addFrame(makeLabels)}}}DisplayFrame.prototype=Object.create(DisplayBase.prototype);DisplayFrame.prototype.constructor=DisplayFrame;DisplayFrame.prototype.domain=function(data,variable){if(this.domainFunction[variable]){return this.domainFunction[variable](this.d3,data,variable)}else{return domainExtent(this.d3,data,variable)}};DisplayFrame.prototype.setDomain=function(variables,domainFunction){var self=this;U.asList(variables).forEach(function(v){self.domainFunction[v]=domainFunction});return this};DisplayFrame.prototype.domainManual=function(variables,range){var r=Array.isArray(range)?range:[0,range];return this.setDomain(variables,function(d3,data,variable){return{domain:r}})};DisplayFrame.prototype.domainZero=function(variables){return this.setDomain(variables,function(d3,data,variable){var d=domainExtent(d3,data,variable);if(d.missing)return d;return{domain:[Math.min(0,d.domain[0]),Math.max(0,d.domain[1])]}})};DisplayFrame.prototype.domainPad=function(variables,padding){var p=Array.isArray(padding)?padding:[padding,padding];return this.setDomain(variables,function(d3,data,variable){var d=domainExtent(d3,data,variable);if(d.missing)return d;return{domain:[d.domain[0]-p[0],d.domain[1]+p[1]]}})};DisplayFrame.prototype.domainIQR=function(variables){return this.setDomain(variables,function(d3,data,variable){var sorted=d3.merge(data).map(U.pick(variable)).sort();if(sorted.length<2||sorted[0]===undefined){return{domain:[0,1],missing:true}}var q1=sorted[Math.floor(.25*sorted.length)];var q3=sorted[Math.floor(.75*sorted.length)];var iqr=q3-q1;return{domain:[Math.max(q1-1.5*iqr,sorted[0]),Math.min(q3+1.5*iqr,sorted[sorted.length-1])]}})};DisplayFrame.prototype.domainBands=function(variables,bands){var pad=this.config.bandPadding;return this.setDomain(variables,function(d3,data,variable){var def={};var vals=U.unstream(bands);if(vals instanceof Array){if(vals.length>0&&vals[0].key!==undefined){def.domain=vals.map(function(d){return d.key});def.config=U.mapToObject(vals,function(d){return[d.key,d]})}else{def.domain=vals}}else{def.domain=U.unique(d3.merge(data).map(U.pick(variable)));if(vals instanceof Object){def.config=vals}}def.scale=d3.scaleBand().domain(def.domain).padding(pad);return def})};DisplayFrame.prototype.domainTime=function(variables){return this.setDomain(variables,function(d3,data,variable){var def=domainExtent(d3,data,variable);def.scale=d3.scaleTime().domain(def.domain);return def})};function domainExtent(d3,data,variable){var e=d3.extent(d3.merge(data),U.pick(variable));if(e.length<2||e.indexOf(undefined)>=0){return{domain:[0,1],missing:true}}return{domain:e}}function makeAxisHorizontal(display,axis,data){var ax=axis[display.config.horizontalVariable];display.display.selectAll("svg").each(function(){var d3ax=display.d3.axisBottom(ax.scale);var g=prepareAxis(display,this,C_AXIS_X,ax,d3ax);g.attr("transform",DU.translateMargins(display.config,0,display.size.inHeight)).call(d3ax);if(display.config.verticalGrid){var g=prepareAxis(display,this,C_GRID_X,ax,d3ax);d3ax.tickSize(-display.size.inHeight,0,0).tickFormat("");g.attr("transform",DU.translateMargins(display.config,0,display.size.inHeight)).call(d3ax)}})}function makeAxisVertical(display,axis,data){var ax=axis[display.config.verticalVariable];display.display.selectAll("svg").each(function(){var d3ax=display.d3.axisLeft(ax.scale);var g=prepareAxis(display,this,C_AXIS_Y,ax,d3ax);g.attr("transform",DU.translateMargins(display.config)).call(d3ax);if(display.config.horizontalGrid){var g=prepareAxis(display,this,C_GRID_Y,ax,d3ax);d3ax.tickSize(-display.size.inWidth,0,0).tickFormat("");g.attr("transform",DU.translateMargins(display.config)).call(d3ax)}})}function prepareAxis(display,svg,cls,axis,d3axis){var svg=display.d3.select(svg);var g=svg.select(DU.s(cls));if(!g.empty()){g.remove()}g=svg.append("g").attr("class",cls);if(axis.config){d3axis.tickFormat(function(x){return U.get(U.get(axis.config,x),display.config.labelVariable)||x})}return g}function makeLabels(display,axis,data){if(data.length>0){var div=display.display.select(DU.s(C_LABELS));if(div.empty()){div=display.display.append("div").attr("class",C_LABELS)}else{div.selectAll("span").remove()}Object.values(U.unstream(display.config.groups)).forEach(function(g){div.append("span").attr("class",display.config.labelClasses).html(g[display.config.labelVariable]).style("background-color",g[display.config.colorVariable])})}}},{"../utility.js":16,"./DisplayBase.js":7,"./utility.js":14}],9:[function(require,module,exports){module.exports=Select;var U=require("../utility.js");var DU=require("./utility.js");var C_FOCUS="d3stream-focus";var C_SELECTION="d3stream-selection";var C_FOCUS_SELECTION="d3stream-focus-selection";function Select(d3,options){this.d3=d3;this.config=options;this.svgs=d3.select();this.selected=[];this.data={}}Select.prototype.register=function(svg){this.svgs=this.svgs.merge(svg)};Select.prototype.clear=function(){this.svgs.selectAll(DU.s(C_SELECTION)).classed(C_SELECTION,false);U.clear(this.selected)};Select.prototype.isSelected=function(d){return this.selected.includes(d)};Select.prototype.select=function(d){this.selected.push(d)};Select.prototype.deselect=function(d){U.remove(this.selected,d)};Select.prototype.event=function(type,control,d,i){if(this.config.selectPlot){selectPlot[type](this,control,d)}else if(!this.config.selectNone){selectShape[type](this,control,d)}if(this.config.select&&this.config.select[type]){this.config.select[type](this,d)}};var selectShape={over:function(select,control,d){if(control.classed(C_SELECTION)){control.classed(C_FOCUS_SELECTION,true)}else{control.classed(C_FOCUS,true)}},out:function(select,control,d){control.classed(DU.a(C_FOCUS,C_FOCUS_SELECTION),false)},click:function(select,control,d){if(!select.isSelected(d)){select.select(d);control.classed(DU.a(C_SELECTION,C_FOCUS_SELECTION),true).classed(C_FOCUS,false)}else{select.deselect(d);control.classed(DU.a(C_SELECTION,C_FOCUS_SELECTION),false).classed(C_FOCUS,true)}}};var selectPlot={over:function(select,control,d){var plot=select.d3.select(control.node().parentNode);if(plot.classed(C_SELECTION)){plot.classed(C_FOCUS_SELECTION,true).raise()}else{plot.classed(C_FOCUS,true).raise()}},out:function(select,control,d){var plot=select.d3.select(control.node().parentNode);plot.classed(DU.a(C_FOCUS,C_FOCUS_SELECTION),false)},click:function(select,control,d){var plot=select.d3.select(control.node().parentNode);if(!select.isSelected(d.payload)){select.select(d.payload);plot.classed(DU.a(C_SELECTION,C_FOCUS_SELECTION),true).classed(C_FOCUS,false)}else{select.deselect(d.payload);plot.classed(DU.a(C_SELECTION,C_FOCUS_SELECTION),false).classed(C_FOCUS,true)}}}},{"../utility.js":16,"./utility.js":14}],10:[function(require,module,exports){var U=require("../utility.js");var DU=require("./utility.js");C_BAR="d3stream-bar";C_GROUP="d3stream-group";module.exports={barChart:barChart,stackedBarChart:stackedBarChart,groupedBarChart:groupedBarChart};function barChart(display,plots,axis,dataSeries,options){for(var i=0;i<dataSeries.length;i++){drawBars(display,plots[i],axis,dataSeries[i],options)}}function stackedBarChart(display,plots,axis,dataSeries,options){var sdata=DU.stack(display.d3,dataSeries,axis,options);for(var i=0;i<sdata.length;i++){drawBars(display,plots[i],axis,sdata[i],options)}}function groupedBarChart(display,plots,axis,dataSeries,options){for(var i=0;i<dataSeries.length;i++){drawBars(display,plots[i],axis,dataSeries[i],options,[i,dataSeries.length])}}function getBarWidth(width,scale,count,options){if(scale.bandwidth){return[scale.bandwidth(),true]}else{var bw=(1-options.barMargin)*width/count;return[bw,bw/2]}}function drawBars(display,plot,axis,data,options,banded){var trans=DU.transition(display.d3,options);var formatter=DU.formatter(display.d3,options);var group=DU.groupSelector(options);var bw=getBarWidth(display.size.inWidth,axis.x.scale,data.length,options);var w=bw[0]/(banded!==undefined?banded[1]:1);var gx=banded!==undefined?banded[0]*w:0;var bars=plot.selectAll(DU.s(C_BAR)).data(data);var enter=bars.enter().append("g").attr("class",C_BAR);enter.append("rect").attr("x",function(d){return axis.x.pick(d,bw[1])+gx}).attr("y",axis.y.pickZero()).attr("width",w).attr("height",0).on("mouseover",DU.event(display.select,"over")).on("mouseout",DU.event(display.select,"out")).on("click",DU.event(display.select,"click"));enter.append("text").attr("x",function(d){return DU.textPadX(options,axis.x.pick(d,bw[1])+gx)}).attr("y",axis.y.pickZero());var merged=bars.merge(enter);merged.select("rect").transition(trans).attr("x",function(d){return axis.x.pick(d,bw[1])+gx}).attr("y",function(d){return options.downwards?axis.y.pickBase(d):axis.y.pick(d)}).attr("width",w).attr("height",function(d){return axis.y.pickDistance(d)}).style("fill",function(d){return DU.fill(d,axis.x,options,group(d))});if(options.chartText){merged.select("text").transition(trans).attr("x",function(d){return DU.textPadX(options,axis.x.pick(d,bw[1])+gx)}).attr("y",function(d){return DU.textPadY(options,axis.y.pick(d))}).text(function(d){return DU.text(axis.y.pickValue(d),formatter,axis.y.pickDistance(d),options,group(d))})}bars.exit().remove()}},{"../utility.js":16,"./utility.js":14}],11:[function(require,module,exports){var DU=require("./utility.js");C_DOT="d3stream-dot";C_LINE="d3stream-line";C_AREA="d3stream-area";module.exports={scatterPlot:scatterPlot,lineChart:lineChart,areaChart:areaChart,stackedAreaChart:stackedAreaChart};function scatterPlot(display,plots,axis,dataSeries,options){for(var i=0;i<dataSeries.length;i++){drawDots(display,plots[i],axis,dataSeries[i],options)}}function lineChart(display,plots,axis,dataSeries,options){for(var i=0;i<dataSeries.length;i++){drawLine(display,plots[i],axis,dataSeries[i],options)}}function areaChart(display,plots,axis,dataSeries,options){for(var i=0;i<dataSeries.length;i++){drawArea(display,plots[i],axis,dataSeries[i],options)}}function stackedAreaChart(display,plots,axis,dataSeries,options){var sdata=DU.stack(display.d3,dataSeries,axis,options);for(var i=0;i<sdata.length;i++){drawArea(display,plots[i],axis,sdata[i],options)}}function getCurveFactory(d3,options){return options.curveLine?d3.curveNatural:options.stepLine?d3.curveStep:d3.curveLinear}function drawDots(display,plot,axis,data,options){data=DU.cutToDomain(data,axis.z.variable,axis.z.domain);var trans=DU.transition(display.d3,options);var formatter=DU.formatter(display.d3,options);var group=DU.groupSelector(options);var dots=plot.selectAll(DU.s(C_DOT)).data(data);var enter=dots.enter().append("g").attr("class",C_DOT);enter.append("circle").attr("cx",function(d){return axis.x.pick(d)}).attr("cy",axis.y.pickZero()).attr("r",axis.z.pickMin()).on("mouseover",DU.event(display.select,"over")).on("mouseout",DU.event(display.select,"out")).on("click",DU.event(display.select,"click"));enter.append("text").attr("x",function(d){return DU.textPadX(options,axis.x.pick(d))}).attr("y",axis.y.pickZero());var merged=dots.merge(enter);merged.select("circle").transition(trans).attr("cx",function(d){return axis.x.pick(d)}).attr("cy",function(d){return axis.y.pick(d)}).attr("r",function(d){return axis.z.pick(d)||axis.z.pickMin()}).style("fill",function(d){return DU.fill(d,axis.x,options,group(d))});if(options.chartText){merged.select("text").transition(trans).attr("x",function(d){return DU.textPadX(options,axis.x.pick(d))}).attr("y",function(d){return DU.textPadY(options,axis.y.pick(d))}).text(function(d){return DU.text(d[axis.y.variable],formatter,axis.y.pickDistance(d),options,group(d))})}dots.exit().remove()}function drawLine(display,plot,axis,data,options){var trans=DU.transition(display.d3,options);var curve=getCurveFactory(display.d3,options);var group=DU.groupSelector(options);var path=plot.select(DU.s(C_LINE));if(path.empty()){var enterLiner=display.d3.line().x(function(d){return axis.x.pick(d)}).y(axis.y.pickZero()).curve(curve);path=plot.append("path").attr("class",C_LINE).attr("d",enterLiner(data))}var liner=display.d3.line().x(function(d){return axis.x.pick(d)}).y(function(d){return axis.y.pick(d)}).curve(curve);path.transition(trans).attr("d",liner(data))}function drawArea(display,plot,axis,data,options){var trans=DU.transition(display.d3,options);var curve=getCurveFactory(display.d3,options);var group=DU.groupSelector(options);var path=plot.select(DU.s(C_AREA));if(path.empty()){var enterArear=display.d3.area().x(function(d){return axis.x.pick(d)}).y0(axis.y.pickZero()).y1(axis.y.pickZero()).curve(curve);path=plot.append("path").attr("class",C_AREA).attr("d",enterArear(data))}var arear=display.d3.area().x(function(d){return axis.x.pick(d)}).y0(function(d){return axis.y.pickBase(d)}).y1(function(d){return axis.y.pick(d)}).curve(curve);path.transition(trans).attr("d",arear(data)).style("fill",DU.fill({},{},options,group(data[0])))}},{"./utility.js":14}],12:[function(require,module,exports){module.exports=function(d3,callback){var resizeTimeout;d3.select(window).on("resize",delayResize);function delayResize(){if(!resizeTimeout){resizeTimeout=setTimeout(doResize,500)}}function doResize(){resizeTimeout=null;callback()}}},{}],13:[function(require,module,exports){var U=require("../utility.js");var DU=require("./utility.js");var C_TABLE="d3stream-table";module.exports={table:table,table2d:table2d};function table(display,axis,dataSeries,options){display.display.selectAll("table").remove();var table=display.display.append("table").attr("class",C_TABLE);var cols=U.unique(display.d3.merge(display.d3.merge(dataSeries).map(Object.keys)));var tr=table.append("tr");for(var i=0;i<cols.length;i++){tr.append("th").text(cols[i])}for(i=0;i<dataSeries.length;i++){data=dataSeries[i];for(var j=0;j<data.length;j++){var row=data[j];tr=table.append("tr");for(var k=0;k<cols.length;k++){tr.append("td").text(row[cols[k]])}}}}function table2d(display,axis,dataSeries,options){var xaxis=axis[options.horizontalVariable];var yaxis=axis[options.verticalVariable];display.display.selectAll("table").remove();var rows=[];var cols=[];var values=[];for(var i=0;i<dataSeries.length;i++){for(var j=0;j<dataSeries[i].length;j++){var d=dataSeries[i][j];var x=xaxis.pickValue(d);if(!rows.includes(x)){rows.push(x)}var r=values[rows.indexOf(x)]||[];var g=d[options.groupVariable];if(!cols.includes(g)){cols.push(g)}r[cols.indexOf(g)]=yaxis.pickValue(d);values[rows.indexOf(x)]=r}}var table=display.display.append("table").attr("class",C_TABLE);var tr=table.append("tr");tr.append("th");var sums=[];var group=DU.groupSelector(options);for(var i=0;i<cols.length;i++){var d=Object.fromEntries([[options.groupVariable,cols[i]]]);tr.append("th").text(U.get(group(d),options.labelVariable)||cols[i]);sums[i]=0}tr.append("th");sums[i]=0;var formatter=DU.formatter(display.d3,options);for(i=0;i<rows.length;i++){tr=table.append("tr");tr.append("th").text(U.get(U.get(xaxis.config,rows[i]),options.labelVariable)||rows[i]);var s=0;for(j=0;j<cols.length;j++){var y=values[i][j];tr.append("td").text(DU.text(y,formatter));s+=y;sums[j]+=y}tr.append("td").append("em").text(DU.text(s,formatter));sums[j]+=s}tr=table.append("tr");tr.append("td");for(i=0;i<=cols.length;i++){tr.append("td").append("em").text(DU.text(sums[i],formatter))}}},{"../utility.js":16,"./utility.js":14}],14:[function(require,module,exports){var U=require("../utility.js");module.exports={translate:function(x,y){return"translate("+x+","+y+")"},translateMargins:function(options,x,y){return this.translate(options.marginLeft+(x||0),options.marginTop+(y||0))},textPadX:function(options,v){return(v||0)+options.textPadding},textPadY:function(options,v){return(v||0)+(options.downwards?-2:1)*options.textPadding},a:function(){return U.argumentsArray(arguments).filter(U.isNonEmpty).join(" ")},s:function(cls){return".".concat(String(cls))},transition:function(d3,options){return d3.transition().duration(options.transitionDuration)},formatter:function(d3,options){return d3.format(options.chartTextFormat)},groupSelector:function(options){var groups=options.groups?U.unstream(options.groups):{};return function(d){return groups[d[options.groupVariable]]}},event:function(select,type){return function(d,i){select.event(type,select.d3.select(this),d,i)}},axis:function(display,data,options){var axis={x:display.axis(data,options.horizontalVariable),y:display.axis(data,options.verticalVariable),z:display.axis(data,options.scaleVariable)};axis.x.scale.rangeRound([0,display.size.inWidth]);axis.y.scale.rangeRound(options.downwards?[0,display.size.inHeight]:[display.size.inHeight,0]);axis.z.scale.rangeRound(options.dotRadiusRange);return axis},stack:function(d3,dataSeries,axis,options){var ybuf={};var sdata=(options.reverseStack?dataSeries.reverse():dataSeries).map(function(serie){return serie.map(function(d){var b=ybuf[d[axis.x.variable]]||0;var n=b+d[axis.y.variable]||0;var out=Object.assign({},d,U.obj([axis.y.baseVariable,b],[axis.y.variable,n]));ybuf[d[axis.x.variable]]=n;return out})});axis.y.domain=d3.extent(d3.merge(sdata).map(U.pick(axis.y.variable)).concat(0));axis.y.scale.domain(axis.y.domain);return sdata},cutToDomain:function(data,parameter,domain){var min=domain[0],max=domain[1];function obj(l){var a={};a[parameter]=l;return a}return data.map(function(d){var l=d[parameter];if(l>max){return Object.assign({},d,obj(max))}else if(l<min){return Object.assign({},d,obj(min))}return Object.assign({},d)})},fill:function(d,axis,options,group){return firstEvaluated(function(){return U.get(d,options.colorVariable)},function(){return U.get(group,options.colorVariable)},function(){return U.get(U.get(axis.config,U.get(d,axis.variable)),options.colorVariable)})},text:function(value,formatter,height,options,group){if(height>2*options.textPadding){return this.a(formatter(value),U.get(group,options.labelVariable))}return""}};function firstEvaluated(){for(var i=0;i<arguments.length;i++){var v=arguments[i]();if(v!==undefined)return v}return undefined}},{"../utility.js":16}],15:[function(require,module,exports){if(typeof define=="function"&&define.amd){define([],function(){return require("./Stream.js")})}else{window.d3Stream=require("./Stream.js")}},{"./Stream.js":1}],16:[function(require,module,exports){module.exports={isStream:function(any){return any!==undefined&&typeof any.unstream=="function"},unstream:function(any){return this.isStream(any)?any.unstream():any},consoleLog:function(d){console.log(d)},argumentsArray:function(args){return Array.prototype.slice.call(args)},get:function(obj,key){return obj!==undefined?obj[key]:undefined},obj:function(){return this.objl(this.argumentsArray(arguments))},objl:function(items){return this.asList(items).reduce(function(out,e){out[e[0]]=e[1];return out},{})},isNotNaN:function(val){return!isNaN(val)},isNonEmpty:function(val){return val&&(val.trim===undefined||val.trim()!=="")},remove:function(list,val){return list.splice(list.indexOf(val),1)},clear:function(list){list.splice(0,list.length)},pick:function(key){return function(obj){return obj!==undefined?obj[key]:undefined}},asList:function(obj){return[].concat(obj!==undefined?obj:[])},splitEach:function(list,sep){return this.asList(list).reduce(function(out,val){return out.concat(val.split(sep))},[])},mapToObject:function(list,callback){return this.objl(this.asList(list).map(callback))},countEach:function(vals){return this.asList(vals).reduce(function(out,val){out[val]=(out[val]||0)+1;return out},{})},navigate:function(data,dotPath){return dotPath.split(".").reduce(function(out,k){return out!==undefined?out[k]:undefined},data)},unique:function(data){return this.asList(data).reduce(function(out,d){if(!out.includes(d))out.push(d);return out},[])},repeat:function(data,other){return this.asList(other).map(function(z){return[data,z]})},cross:function(data,other){const t=this;return t.asList(data).map(function(d){return t.asList(other).map(function(z){return[d,z]})})},group:function(data,conditions){var groups=this.asList(conditions).map(function(c){return[]});this.asList(data).forEach(function(d){for(var i=0;i<groups.length;i++){if(conditions[i](d)){groups[i].push(d);return}}});return groups},cumulate:function(data,parameters){var keys=this.asList(parameters);return this.asList(data).reduce(function(out,d){if(out.length>0){keys.forEach(function(k){d[k]=out[out.length-1][k]+(d[k]||0)})}out.push(d);return out},[])}};if(!Array.prototype.map){Array.prototype.map=function(callback){var out=[];for(var i=0;i<this.length;i++){out.push(callback(this[i],i,this))}return out}}if(!Array.prototype.filter){Array.prototype.filter=function(callback){var out=[];for(var i=0;i<this.length;i++){if(callback(this[i],i,this)){out.push(this[i])}}return out}}if(!Array.prototype.reduce){Array.prototype.reduce=function(callback,initial){var out=initial;for(var i=0;i<this.length;i++){out=callback(out,this[i],i,this)}return out}}if(!Array.prototype.forEach){Array.prototype.forEach=function(callback){for(var i=0;i<this.length;i++){callback(this[i],i,this)}}}if(!Array.prototype.includes){Array.prototype.includes=function(val){return this.indexOf(val)>=0}}if(!Object.keys){Object.keys=function(obj){var keys=[];for(var key in obj){if(obj.hasOwnProperty(key))keys.push(key)}return keys}}if(!Object.values){Object.values=function(obj){return Object.keys(obj).map(function(k){return obj[k]})}}if(!Object.assign){Object.assign=function(){merged=arguments.length>0?arguments[0]:undefined;for(var i=1;i<arguments.length;i++){var a=arguments[i];Object.keys(a||{}).forEach(function(k){merged[k]=a[k]})}return merged}}},{}]},{},[15]);