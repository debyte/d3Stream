<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>deSummary demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.slim.min.js" integrity="sha256-k2WSCIexGzOj3Euiig+TlR8gA0EmPjuc79OEeY5L45g=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.5/umd/popper.min.js" integrity="sha256-jpW4gXAhFvqGDD5B7366rIPD7PDbAmqq4CO0ZnHbdM4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha256-DiWJXXyq81WlPRnDfGmgYZj2aOVCKyEdJ1l+2TmDuAs=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha256-m/h/cUDAhf6/iBRixTbuc8+Rg2cIETQtPcH9D3p2Kg0=" crossorigin="anonymous" />
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="desummary.js" type="text/javascript"></script>
    <link rel="stylesheet" href="desummary.css">
    <script type="text/javascript">
      $(function () {

        var $element = $('#simple .card-body');
        var dSimple = deSummary.load({
          data: [5,2,3,4,4,7,4,3,5,6],
          domain: deSummary.domainPad([0.5, 1]),
          selected: deSummary.consoleLog,
        }).add($element, deSummary.lineDiagram, {
          transform: deSummary.mapIndexedValues,
        })
        .add($element, deSummary.barDiagram, {
          transform: deSummary.mapIndexedValues,
        });

        var $shake = $('<button>?</button>').on('click', function (event) {
          dSimple.update(d3.shuffle(dSimple.model.data));
        });
        var $plus = $('<button>+</button>').on('click', function (event) {
          dSimple.update(dSimple.model.data.concat(Math.floor(Math.random() * 10)));
        });
        var $minus = $('<button>-</button>').on('click', function (event) {
          dSimple.update(dSimple.model.data.slice(0, dSimple.model.data.length - 1));
        });
        $element.append($minus).append($shake).append($plus);

        deSummary.load({
          data: [
            { id: "123N", "1.1 Count": 1, "1.1 Total": 10, "1.1 Max": 10, "1.2 Count": 2, "1.2 Total": 10, "1.2 Max": 10, "1.3 Count": 4, "1.3 Total": 50, "1.3 Max": 50 },
            { id: "124O", "1.1 Count": 3, "1.1 Total": 10, "1.1 Max": 10, "1.2 Count": 3, "1.2 Total": 10, "1.2 Max": 10, "1.3 Count": 6, "1.3 Total": 40, "1.3 Max": 50 },
            { id: "125P", "1.1 Count": 2, "1.1 Total": 5, "1.1 Max": 10, "1.2 Count": 2, "1.2 Total": 0, "1.2 Max": 10, "1.3 Count": 100, "1.3 Total": 0, "1.3 Max": 50 },
            { id: "126Q", "1.1 Count": 0, "1.1 Total": 0, "1.1 Max": 10, "1.2 Count": 0, "1.2 Total": 0, "1.2 Max": 10, "1.3 Count": 0, "1.3 Total": 0, "1.3 Max": 50 },
          ],
          selected: deSummary.consoleLog,
          selectPlot: true,
          scale: {
            x: deSummary.scaleBand,
          },
        }).addMany('#lines .card-body', deSummary.lineDiagram, {
          transformToMany: deSummary.cross([ '1.1', '1.2', '1.3' ]),
          transform: [
            deSummary.map(function(d, i) {
              return {
                x: i,
                y: d[0][d[1] + ' Total'],
                z: d[0][d[1] + ' Count'],
                band: d[1],
                payload: d,
              };
            }),
            deSummary.cumulate('y'),
          ],
          domain: {
            z: deSummary.domainIQR,
          },
        }).addMany('#bars .card-body', deSummary.stackedBarDiagram, {
          transformToMany: [
            deSummary.repeat([ '1.1', '1.2', '1.3' ]),
            deSummary.map(function (d, i) {
              var count = d[1] + ' Count';
              var total = d[1] + ' Total';
              var max = d[1] + ' Max';
              var groups = deSummary.u.group(d[0], [
                function (d) {
                  return d[count] == 0;
                },
                function (d) {
                  return d[total] < 0.9 * d[max];
                },
                function (d) {
                  return true;
                },
              ]);
              return deSummary.u.map(groups, function (g, i) {
                return {
                  x: i,
                  y: g.length,
                  z: 0,
                  band: d[1],
                  payload: g,
                };
              });
            }),
            deSummary.consoleLog,
          ],
        });

        /*
        var posts = ;
        var d3 = deSummary.load({
          data: { wrap: { posts: [
            { num: 4, opt: "a", txt: "Lorem ipsum." },
            { num: 3, opt: "a" },
            { num: 4, opt: "b" },
            { num: 8, opt: "a", txt: "Dolor sit <strong>amet</strong>!" },
          ]}},
          transform: deSummary.navigate('wrap.posts'),
        }).load({
          target: 'fields',
          data: [{ key: "opt", type: "radio", enum: [ "a", "b", "c" ] }],
          transform: [
            deSummary.prepend([{ key: "num", type: "number", title: "Number" }]),
            deSummary.append([{ key: "txt", type: "text" }]),
          ],
        }).build('#fields .card-body', deSummary.buildFields, {
          fieldSource: 'fields',
          source: 'data',
        });
        */
      });
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="card" id="simple">
        <div class="card-header bg-info text-white">
          Simple
        </div>
        <div class="card-body"></div>
      </div>
      <div class="card" id="lines">
        <div class="card-header bg-info text-white">
          Lines
        </div>
        <div class="card-body"></div>
      </div>
      <div class="card" id="bars">
        <div class="card-header bg-info text-white">
          Bars
        </div>
        <div class="card-body"></div>
      </div>
      <div class="card" id="fields">
        <div class="card-header bg-info text-white">
          Fields
        </div>
        <div class="card-body"></div>
      </div>
    </div>
  </body>
</html>
